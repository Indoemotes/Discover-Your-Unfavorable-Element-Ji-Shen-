<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kasir Lanjutan - Yatra Tea House</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .produk-item, .kategori-item { transition: all 0.2s ease-in-out; }
        .produk-item:hover, .kategori-item:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .kategori-item.active { background-color: #1D4ED8; color: white; }
        .struk-cetak { font-family: 'Source Code Pro', monospace; }
        .payment-option.active { border-color: #2563EB; background-color: #EFF6FF; }
        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] { -moz-appearance: textfield; }

        @media print {
            body * { visibility: hidden; }
            .struk-panel, .struk-panel * { visibility: visible; }
            .struk-panel { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; border: none; box-shadow: none; }
            .tombol-aksi, .pembayaran-ui, .produk-panel, .judul-keranjang, .keranjang-aksi { display: none !important; }
            .struk-cetak { box-shadow: none; border: none; padding: 20px; }
            table thead { display: table-header-group; }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 md:p-6">
        <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">

            <!-- Panel Produk (Kiri) -->
            <div class="lg:col-span-2 produk-panel">
                <div class="bg-white p-5 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Pilih Kategori</h2>
                    <div id="kategori-list" class="flex flex-wrap gap-3 mb-5">
                        <!-- Kategori akan di-render di sini -->
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 border-t pt-4">Daftar Produk</h2>
                    <div id="produk-list" class="grid grid-cols-2 sm:grid-cols-3 gap-4 min-h-[200px]">
                        <!-- Produk akan di-render di sini -->
                    </div>
                </div>
            </div>

            <!-- Panel Struk (Kanan) -->
            <div class="lg:col-span-3 struk-panel">
                <div class="bg-white p-5 rounded-xl shadow-md">
                    <div class="struk-cetak">
                        <div class="text-center mb-5">
                            <h2 class="text-2xl font-bold text-gray-800">Yatra Tea House</h2>
                            <p class="text-sm text-gray-600">Tambi, Wonosobo</p>
                            <p class="text-sm text-gray-600">082135997989</p>
                        </div>
                        <div class="mb-4 text-xs text-gray-500 border-t border-b border-dashed py-2">
                            <p id="struk-id"></p>
                            <p id="struk-tanggal"></p>
                            <p id="struk-pembayaran" class="font-semibold"></p>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2 judul-keranjang">Keranjang</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white">
                                <thead>
                                    <tr>
                                        <th class="py-2 px-2 text-left text-xs font-semibold text-gray-600 uppercase">Barang</th>
                                        <th class="py-2 px-2 text-right text-xs font-semibold text-gray-600 uppercase">Subtotal</th>
                                        <th class="py-2 px-2 text-center text-xs font-semibold text-gray-600 uppercase keranjang-aksi">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="keranjang-body" class="text-gray-700"></tbody>
                            </table>
                        </div>
                        <div class="mt-5 border-t border-dashed pt-4">
                            <div class="flex justify-between items-center text-gray-800">
                                <p class="text-lg font-bold">Total</p>
                                <p id="total-harga" class="text-xl font-bold">Rp 0</p>
                            </div>
                        </div>
                        <div class="text-center mt-6 border-t border-dashed pt-4">
                            <p class="text-sm font-semibold">-- Terima Kasih --</p>
                        </div>
                    </div>

                    <!-- UI Pembayaran -->
                    <div class="mt-6 border-t pt-6 pembayaran-ui">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">Metode Pembayaran</h3>
                        <div id="payment-options" class="grid grid-cols-3 gap-3 mb-4">
                            <button data-payment="Cash" class="payment-option border-2 border-gray-300 rounded-lg p-3 text-center font-semibold">Cash</button>
                            <button data-payment="QRIS" class="payment-option border-2 border-gray-300 rounded-lg p-3 text-center font-semibold">QRIS</button>
                            <button data-payment="Transfer" class="payment-option border-2 border-gray-300 rounded-lg p-3 text-center font-semibold">Transfer</button>
                        </div>
                        <div id="cash-payment-section" class="hidden">
                            <div class="flex flex-col sm:flex-row gap-4">
                                <input type="number" id="jumlah-bayar" placeholder="Jumlah uang tunai" class="flex-grow w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <button id="btn-bayar" class="w-full sm:w-auto bg-blue-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-600">Hitung</button>
                            </div>
                            <div class="mt-4 flex justify-between items-center">
                                <p class="text-lg font-bold">Kembalian:</p>
                                <p id="kembalian" class="text-xl font-bold text-green-600">Rp 0</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 flex flex-col sm:flex-row gap-4 tombol-aksi">
                        <button id="btn-cetak" class="flex-1 bg-teal-500 text-white font-semibold py-3 px-4 rounded-lg hover:bg-teal-600">Cetak Struk</button>
                        <button id="btn-baru" class="flex-1 bg-gray-700 text-white font-semibold py-3 px-4 rounded-lg hover:bg-gray-800">Transaksi Baru</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const produkData = {
            "Aneka Teh Hitam": [
                { id: 101, nama: 'Classic Black Tea', harga: 15000 },
                { id: 102, nama: 'Earl Grey', harga: 18000 },
                { id: 103, nama: 'English Breakfast', harga: 18000 },
            ],
            "Aneka Teh Hijau": [
                { id: 201, nama: 'Pure Green Tea', harga: 15000 },
                { id: 202, nama: 'Jasmine Green Tea', harga: 17000 },
                { id: 203, nama: 'Matcha Latte', harga: 25000 },
            ],
            "Aneka Teh Putih": [
                { id: 301, nama: 'Silver Needle', harga: 28000 },
                { id: 302, nama: 'White Peony', harga: 26000 },
            ],
            "Camilan": [
                { id: 401, nama: 'Roti Bakar', harga: 15000 },
                { id: 402, nama: 'Kentang Goreng', harga: 13000 },
                { id: 403, nama: 'Pisang Goreng', harga: 12000 },
            ],
        };

        let keranjang = [];
        let idTransaksi = 0;
        let metodePembayaran = '';

        const produkListEl = document.getElementById('produk-list');
        const kategoriListEl = document.getElementById('kategori-list');
        const keranjangBodyEl = document.getElementById('keranjang-body');
        const totalHargaEl = document.getElementById('total-harga');
        const jumlahBayarEl = document.getElementById('jumlah-bayar');
        const kembalianEl = document.getElementById('kembalian');
        const btnBayar = document.getElementById('btn-bayar');
        const btnCetak = document.getElementById('btn-cetak');
        const btnBaru = document.getElementById('btn-baru');
        const strukIdEl = document.getElementById('struk-id');
        const strukTanggalEl = document.getElementById('struk-tanggal');
        const strukPembayaranEl = document.getElementById('struk-pembayaran');
        const paymentOptionsEl = document.getElementById('payment-options');
        const cashPaymentSectionEl = document.getElementById('cash-payment-section');

        function formatRupiah(angka) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(angka);
        }

        function renderKategori() {
            kategoriListEl.innerHTML = '';
            Object.keys(produkData).forEach(kategori => {
                const item = document.createElement('button');
                item.className = 'kategori-item bg-white p-3 rounded-lg border-2 border-gray-300 text-center cursor-pointer font-semibold text-sm';
                item.textContent = kategori;
                item.addEventListener('click', () => {
                    document.querySelectorAll('.kategori-item.active').forEach(activeEl => activeEl.classList.remove('active'));
                    item.classList.add('active');
                    renderProduk(kategori);
                });
                kategoriListEl.appendChild(item);
            });
        }

        function renderProduk(kategori) {
            produkListEl.innerHTML = '';
            const produkDiKategori = produkData[kategori];
            produkDiKategori.forEach(p => {
                const item = document.createElement('div');
                item.className = 'produk-item bg-white p-3 rounded-lg border border-gray-200 text-center cursor-pointer';
                item.innerHTML = `
                    <div class="font-semibold text-gray-800 text-sm">${p.nama}</div>
                    <div class="text-blue-500 font-medium mt-1">${formatRupiah(p.harga)}</div>
                `;
                item.addEventListener('click', () => updateKeranjang(p, 'tambah'));
                produkListEl.appendChild(item);
            });
        }

        function updateKeranjang(produk, aksi, kuantitasBaru = null) {
            const itemDiKeranjang = keranjang.find(item => item.id === produk.id);
            if (itemDiKeranjang) {
                if (aksi === 'tambah') {
                    itemDiKeranjang.kuantitas++;
                } else if (aksi === 'kurang') {
                    itemDiKeranjang.kuantitas--;
                } else if (aksi === 'input' && kuantitasBaru !== null) {
                    itemDiKeranjang.kuantitas = kuantitasBaru;
                }
                if (itemDiKeranjang.kuantitas <= 0) {
                    keranjang = keranjang.filter(item => item.id !== produk.id);
                }
            } else if (aksi === 'tambah') {
                keranjang.push({ ...produk, kuantitas: 1 });
            }
            renderKeranjang();
        }

        function renderKeranjang() {
            keranjangBodyEl.innerHTML = '';
            let total = 0;
            if (idTransaksi === 0 && keranjang.length > 0) idTransaksi = Date.now();
            
            if (keranjang.length === 0) {
                keranjangBodyEl.innerHTML = '<tr><td colspan="3" class="text-center py-8 text-gray-500">Keranjang masih kosong</td></tr>';
                idTransaksi = 0;
            } else {
                keranjang.forEach(item => {
                    const subtotal = item.harga * item.kuantitas;
                    total += subtotal;
                    const tr = document.createElement('tr');
                    tr.className = 'border-b border-dashed';
                    // UPDATED: Reduced padding and font sizes for a more compact look
                    tr.innerHTML = `
                        <td class="py-1.5 px-2">
                            <span class="font-medium text-sm">${item.nama}</span>
                            <span class="text-gray-600 text-sm">(x${item.kuantitas})</span>
                            <span class="text-xs text-gray-500 block">@${formatRupiah(item.harga)}</span>
                        </td>
                        <td class="py-1.5 px-2 text-right font-medium text-sm">${formatRupiah(subtotal)}</td>
                        <td class="py-1.5 px-2 text-center keranjang-aksi">
                            <div class="flex items-center justify-center gap-1">
                                <button class="btn-kurang bg-gray-200 rounded-full w-6 h-6 font-bold flex items-center justify-center" data-id="${item.id}">-</button>
                                <input type="number" class="qty-input w-12 text-center border rounded bg-white text-sm" value="${item.kuantitas}" data-id="${item.id}" min="0">
                                <button class="btn-tambah bg-gray-200 rounded-full w-6 h-6 font-bold flex items-center justify-center" data-id="${item.id}">+</button>
                            </div>
                        </td>
                    `;
                    keranjangBodyEl.appendChild(tr);
                });
            }

            totalHargaEl.textContent = formatRupiah(total);
            const now = new Date();
            strukIdEl.textContent = idTransaksi ? `ID Transaksi: ${idTransaksi}` : '';
            strukTanggalEl.textContent = idTransaksi ? `Tanggal: ${now.toLocaleString('id-ID')}` : '';
            strukPembayaranEl.textContent = ''; // Kosongkan saat render ulang
            resetPembayaran();
        }

        function resetPembayaran() {
            jumlahBayarEl.value = '';
            kembalianEl.textContent = formatRupiah(0);
        }

        function hitungKembalian() {
            const total = keranjang.reduce((sum, item) => sum + (item.harga * item.kuantitas), 0);
            const bayar = parseFloat(jumlahBayarEl.value) || 0;
            if (bayar < total) {
                alert('Jumlah uang yang dibayarkan kurang!');
                return;
            }
            kembalianEl.textContent = formatRupiah(bayar - total);
        }

        function transaksiBaru() {
            if (confirm('Mulai transaksi baru? Keranjang akan dikosongkan.')) {
                keranjang = [];
                idTransaksi = 0;
                metodePembayaran = '';
                document.querySelectorAll('.payment-option.active').forEach(el => el.classList.remove('active'));
                cashPaymentSectionEl.classList.add('hidden');
                renderKeranjang();
            }
        }

        function cetakStruk() {
            if (keranjang.length === 0) {
                alert('Keranjang kosong, tidak ada yang bisa dicetak.');
                return;
            }
            if (!metodePembayaran) {
                alert('Silakan pilih metode pembayaran terlebih dahulu.');
                return;
            }
            // Tampilkan metode pembayaran hanya saat akan mencetak
            strukPembayaranEl.textContent = `Pembayaran: ${metodePembayaran}`;
            window.print();
        }

        paymentOptionsEl.addEventListener('click', e => {
            if (e.target.tagName === 'BUTTON') {
                document.querySelectorAll('.payment-option.active').forEach(activeEl => activeEl.classList.remove('active'));
                e.target.classList.add('active');
                metodePembayaran = e.target.dataset.payment;
                if (metodePembayaran === 'Cash') {
                    cashPaymentSectionEl.classList.remove('hidden');
                } else {
                    cashPaymentSectionEl.classList.add('hidden');
                    resetPembayaran();
                }
            }
        });

        function getProdukById(id) {
            for (const kategori in produkData) {
                const found = produkData[kategori].find(p => p.id === id);
                if (found) return found;
            }
            return null;
        }

        keranjangBodyEl.addEventListener('click', e => {
            const target = e.target;
            if (target.tagName !== 'BUTTON') return;
            const productId = parseInt(target.dataset.id);
            const produk = getProdukById(productId);
            if (!produk) return;

            if (target.classList.contains('btn-tambah')) {
                updateKeranjang(produk, 'tambah');
            } else if (target.classList.contains('btn-kurang')) {
                updateKeranjang(produk, 'kurang');
            }
        });

        keranjangBodyEl.addEventListener('input', e => {
            const target = e.target;
            if (target.classList.contains('qty-input')) {
                const productId = parseInt(target.dataset.id);
                const kuantitasBaru = parseInt(target.value) || 0;
                const produk = getProdukById(productId);
                if (produk) {
                    updateKeranjang(produk, 'input', kuantitasBaru);
                }
            }
        });

        btnBayar.addEventListener('click', hitungKembalian);
        btnBaru.addEventListener('click', transaksiBaru);
        btnCetak.addEventListener('click', cetakStruk);

        renderKategori();
        const kategoriPertama = Object.keys(produkData)[0];
        if (kategoriPertama) {
            document.querySelector('.kategori-item').classList.add('active');
            renderProduk(kategoriPertama);
        }
        renderKeranjang();
    });
    </script>
</body>
</html>
